# 图片背景去除工具

这是一个功能完整的图片背景去除工具套件，提供图形界面、命令行和批量处理三种使用方式。该工具使用 `rembg` 库来实现自动背景去除功能。

## 安装依赖

在使用此工具之前，请先安装必要的依赖：

```bash
# 方法1：直接安装依赖
pip install rembg Pillow tqdm

# 方法2：通过setup.py安装（推荐）
pip install -e .
=======
```

## 使用方法

本工具提供三种使用方式，可以根据需求选择最适合的方式：

### 1. 图形界面版本（推荐日常使用）

运行以下命令启动图形界面版本：

```bash
python remove_bg_gui.py
```

图形界面提供以下功能：
1. 选择图片：点击"选择图片"按钮，选择要处理的图片
2. 去除背景：点击"去除背景"按钮，开始处理图片
3. 保存结果：点击"保存图片"按钮，将处理后的图片保存到指定位置

### 2. 命令行版本

如果你需要处理单张图片，可以使用以下命令：

```bash
python remove_bg.py 输入图片路径 输出图片路径
```

例如：
```bash
python remove_bg.py input.jpg output.png
```

### 3. 批量处理版本

如果你需要一次处理多张图片，可以使用批量处理工具：

```bash
python batch_remove_bg.py 输入目录 [--output-dir 输出目录] [--workers 线程数]
```

例如：
```bash
# 处理 images 目录下的所有图片，结果保存到 images_nobg 目录
python batch_remove_bg.py images

# 指定输出目录和4个处理线程
python batch_remove_bg.py images --output-dir output --workers 4
```

批量处理功能：
- 自动处理指定目录下的所有支持格式的图片
- 显示处理进度条
- 支持多线程并行处理
- 自动创建输出目录
- 详细的处理结果统计

## 注意事项

1. 首次运行时，`rembg` 库会自动下载必要的模型文件，这可能需要一些时间
2. 处理大图片时可能需要较长时间，请耐心等待
3. 输出图片将自动保存为 PNG 格式，以保持透明背景
4. 建议使用图形界面版本，因为它提供了实时预览功能

## 支持的图片格式

- PNG
- JPEG/JPG
- BMP
- WebP

## 故障排除

### 运行诊断

如果遇到问题，可以运行诊断脚本来检查环境：

```bash
python diagnose.py
```

诊断脚本会检查：
- Python环境信息
- 依赖库的安装状态
- rembg的详细信息
- 可能的问题原因
- 提供解决建议

### 常见问题解决

1. 提示"未检测到rembg库"
   - 确认是否正确安装：`pip install rembg`
   - 检查Python环境：运行诊断脚本查看当前使用的Python路径
   - 尝试使用GUI版本中的"帮助"菜单安装rembg
   - 如果以上方法都不行，尝试：`python -m pip install --upgrade rembg`

2. rembg安装成功但程序无法识别
   - 可能是由于多个Python环境导致的问题
   - 运行诊断脚本确认当前使用的Python环境
   - 在正确的环境中重新安装rembg
   - 确保使用相同的Python环境运行程序

3. 处理图片时出错
   - 确保图片格式受支持（PNG、JPEG、BMP、WebP）
   - 检查图片是否损坏
   - 确保系统有足够的内存
   - 对于大图片，可以先调整大小再处理

4. 性能问题
   - 第一次运行时会下载模型文件，可能需要一些时间
   - 处理大图片时可能会比较慢
   - 批量处理时可以调整线程数（--workers参数）
   - 确保系统有足够的内存

### 其他注意事项

1. 首次运行
   - 首次运行时会自动下载模型文件（约100MB）
   - 请确保网络连接正常
   - 下载完成后会缓存模型文件，后续使用不需要重新下载

2. 环境要求
   - Python 3.6 或更高版本
   - 建议使用虚拟环境
   - 需要足够的磁盘空间存储模型文件
   - 建议有4GB或更多内存

3. 如果问题持续存在
   - 运行诊断脚本获取详细信息
   - 检查Python和pip是否正确安装
   - 尝试在新的虚拟环境中安装和运行

## 技术说明

此工具使用了以下技术：
- rembg：用于图片背景去除
- Pillow：用于图片处理
- tkinter：用于图形界面（GUI版本）
- threading：用于并行处理和防止GUI卡死
- tqdm：用于显示进度条
- concurrent.futures：用于实现多线程处理

## 许可证

MIT License